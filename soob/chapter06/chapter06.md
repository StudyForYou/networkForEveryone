# 6장 전송 계층, 오류 없이 데이터를 전달하는 단계

## Lesson25 전송 계층의 역할

- 전송 계층은 기본적으로 오류를 점검하는 기능과 컴퓨터가 제대로 데이터를 받았을 경우 어떤 애플리케이션으로 전달해야 하는지를 식별하는 기능을 함

### 1. 혼잡 제어

- 네트워크로 들어가는 정보량을 조절하여 네트워크가 혼잡해지지 않게 조절하는 방법
- 송신자는 먼저 하나의 데이터만 보내고 수신자 측에서 ACK가 오면 전송량을 2배씩 증가시켜 나감
- 타임아웃이 발생하면 여러 개 보냈던 데이터를 줄여서 보냄
- 동일한 ACK를 여러 번 받는 경우에도 데이터를 줄여서 보내는 방식을 취함
- 타임아웃이나 ACK를 여러 번 받았다는 것은 네트워크가 데이터를 실어 나르느라 바쁘다는 의미
- 정상적인 ACK를 받으면 또다시 데이터를 배수로 전송함으로써 데이터 전송량을 조절함

### 2. 흐름 제어

- 데이터 링크 계층에서 사용했던 정지-대기 방식과 동일
- 정지-대기 방식은 송신자가 하나의 데이터를 전송한 후 다음 데이터를 전달하기 전에 확인 응답을 기다리는 방법
- 수신자 측에서 ACK라는 메시지가 송신자 측에 전달되어야만 다음 데이터를 보내는 방법

### 3. 오류 제어

- 오류를 검출하기 위해서는 확인 응답과 시간 초과 방법을 사용함
- 확인 응답: 수신자 측으로부터 ACK라는 응답을 받아야 하지만 없다면 오류로 판단
- 시간 초과: 특정 시간 내에 ACK가 엇으면 세그먼트에 오류가 있다고 판단
- 오류가 발견되면 데이터를 재전송해야 함
- 재전송이 필요한 상황
  - 데이터가 중간에 손실될 때
  - 데이터 순서가 바뀌었을 때
  - 데이터가 훼손되었을 때

## Lesson26 3방향 핸드셰이크

- 전송 계층은 데이터를 목적지에 문제엇이 전달하는 것을 목표로 함
- 데이터를 전달하는 목적에 따라 연결형과 비연결형 통신으로 나뉨
  - 연결형 통신: 데이터를 정확하게 전달하는 것을 목표로 하는 통신, TCP 프로토콜을 사용함
  - 비연결형 통신: 효율적으로 데이터를 보내는 통신으로, UDP 프로토콜을 사용함
- TCP 프로토콜잍 통신하는 방법
  - 3방향 핸드셰이크 방법으로 통신을 시작함
  - 상대방이 내 신호를 받을 수 있는 상태인지 확인하고 전송하는 방식
  - 3방향 핸드셰이크: TCP 통신을 하는 장치 간에 서로 통신할 준비가 되었는지를 확인하는 과정
    - 송신자는 수신자에게 SYN이라는 임의의 숫자를 보냄
    - 수신자는 ACK, SYN을 보냄
    - ACK는 앞에서 받았던 SYN에 1이 더해진 숫자이며, SYN은 임의의 숫자가 됨
    - 송신자가 다시 ACK를 보냄, 이때 ACK는 앞에서 받은 SYN에 1이 더해진 숫자
    - 양쪽 모두 데이터를 전송할 준비가 되었다는 것을 보장함

## Lesson27 TCP의 구조

- 전송 계층에 포함되는 헤더 정보

### 1. 포트 번호

- 프로그램의 주소
- 0~1023번: 특정한 쓰임을 위해 사용되는 포트
  - 20: FTP / FTP로 데이터 전송 프로토콜
  - 22: SSH / SSH, SFTP와 같은 프로토콜
  - 23: TeInet / 암호화되지 않은 텍스트 통신 프로토콜
  - 25: SMTP / 이메일 전송 프로토콜
  - 53: DNS / IP 주소와 도메인 이름 변환 프로토콜
  - 80: HTTP / 웹 페이지 전송 프로토콜
  - 123: NTP / 시간 동기화 프로토콜
  - 443: HTTPS / 암호화된 웹 페이지 전송 프로토콜
- 1024~49151번: 기관이나 기업들이 사용하는 포트, 사전 등록된 포트
- 49152~65535: 일반 사용자들이 자유롭게 사용할 수 있는 포트, 다이내믹 포트

### 2. 일련번호와 확인 응답 번호

- 일련번호: 송신자가 수신자에게 보내려는 데이터가 몇 번째인지 알려주는 것
- 확인 응답 번호: 수신자가 몇 번째 데이터를 받았는지 송신자에게 알려주는 역할
- 예시
  - 보내야 할 총 데이터 크기: 1500바이트 / 패킷의 크기: 500바이트
  - 패킷의 크기: 한 번에 보낼 수 있는 데이터의 최대 크기
  - 1500바이트의 데이터를 보내기 위해서는 3번에 걸쳐 보내야 함
  - 처음 일련번호가 1이라고 가정할 때 다음 일련번호는 1에서 500이 더해진 값이고, 이후는 501에 500이 더해진 값

### 3. 윈도우 크기

- 송신자가 한 번에 보낼 수 있는 데이터의 최대 크기
- 수신자가 얼마나 데이터를 받아들일 수 있는지 확인한 후, 크기를 고려해서 데이터를 보냄
- 3방향 핸드셰이크 과정에서 SYN, ACK 외에도 Window_Size라는 정보를 주고받게 됨
- 이렇게 확인된 윈도우 크기를 이용하여 좀 더 효율적으로 데이터를 전송할 수 있음

### 4. 코드 비트

- 모두 기본값은 0이고 비트가 활성화되면 1이 됨
- 코드 비트에 속한 항목
  - TURG: 긴급 처리 데이터가 있음
  - ACK: 확인 응답 번호 사용
  - RSH: TCP가 받은 데이터를 상위 계층에 전달
  - RST: 연결 재설정
  - SYN: 연결을 초기화하기 위해 순서 번호를 동기화
  - FIN: 데이터 송신 종료
- 코드 비트를 이용해서 연결을 제어할 수 있음

## Lesson28 UDP의 구조

- TCP는 데이터를 세그먼트라는 단위로 쪼갠 후 순서를 부여하여 전송함
- 수신자 입장에서 세그먼트의 순서가 뒤바뀌는 일이 없도록 오류를 제어하는 것도 중요함
- UDP는 데이터를 수신자 측에서 오류 없이 받던, 그렇지 않던 상관하지 않고 데이터를 보내기만 함
- 신뢰성을 보장하지 않는 만큼 데이터 전송 속도가 빠른 장점이 있음
- UDP 프로토콜은 주로 실시간 방송 등에사용함
- 브로드캐스트에 사용되는 프로토콜이 UDP
- UDP 프로토콜 헤더
  - TCP와 비교했을 때 축약된 정보만 포함함고 있음
  - 송,수신자의 포트 번호 / 헤더 길이 / 검사합
  - 송신자 포트 번호: 데이터를 보낼 때 사용되는 애플리케이션의 포트 번호
  - 수신자의 포트 번호: 데이터를 받을 애플리케이션의 포트 번호
  - 헤더 길이: UDP 헤더와 데이터를 합한 총 길이
  - 검사합: 데이터의 무결설 검사(오류 검사) 용도

## Lesson29 전송 계층에서 사용하는 로드 밸런서

- 여러 대의 서버를 두고 사용자가 한쪽으로 몰리는 것을 분산시켜주는 장치
- 스케일 아웃: 1대의 서버에서 여러 대로 늘리는 것
- 로드 밸런싱: 부하를 분산시켜주는 작업
- 사용자가 보내온 연결 요청은 로드 밸런서가 받음
- 이후 로드 밸런서는 또다시 서버로 연결을 요청함
- 그런데 서버는 3대, 골고루 사용자 연결을 처리해야 함
- 부하를 분산시키는 방법
  - 라운드 로빈: 분배의 가장 기본적인 방식으로 각 서버별로 돌아가면서 연결을 처리함
  - 가중 라운드 로빈: 각 서버별로 돌아가면서 연결을 처리하지만 일부 서버는 큰 트래픽을 몰아 받는 방식
  - 랜덤: 무작위로 분배되는 방식
  - 해시: 특정 클라이언트는 특정 서버에서만 처리하는 방식
- 포트 번호를 이용하여 부하를 분산시킬 수도 있음
  - 로드 밸런서 IP 주소로 접속을 시도하는 것 중에 8001번 포트를 사용하는 것 / 8002번 포트를 사용하는 것을 각각 다른 서버로 전달하도록 설정 가능
